generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model audit_logs {
  id        String      @id
  userId    String
  action    AuditAction
  timestamp DateTime    @default(now())
  payload   Json?
  ipAddress String?
  userAgent String?
  users     users       @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model role_permissions {
  id         String  @id
  role       Role
  permission String
  canAccess  Boolean @default(false)

  @@unique([role, permission])
}

model team_members {
  id                                   String   @id
  teamId                               String
  userId                               String
  roleInTeam                           TeamRole @default(MEMBER)
  assignedBy                           String?
  joinedAt                             DateTime @default(now())
  updatedAt                            DateTime
  users_team_members_assignedByTousers users?   @relation("team_members_assignedByTousers", fields: [assignedBy], references: [id])
  teams                                teams    @relation(fields: [teamId], references: [id], onDelete: Cascade)
  users_team_members_userIdTousers     users    @relation("team_members_userIdTousers", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([teamId, userId])
}

model teams {
  id                String         @id
  name              String
  description       String?
  ownerId           String
  plan              Plan           @default(FREE)
  isActive          Boolean        @default(true)
  createdAt         DateTime       @default(now())
  updatedAt         DateTime
  billingCustomerId String?
  team_members      team_members[]
  users             users          @relation(fields: [ownerId], references: [id])
}

model users {
  id                                          String         @id
  email                                       String         @unique
  passwordHash                                String?
  name                                        String
  phoneNumber                                 String?
  gender                                      Gender?
  dateOfBirth                                 DateTime?
  role                                        Role           @default(MEMBER)
  avatarUrl                                   String?
  isActive                                    Boolean        @default(true)
  oauthProvider                               OAuthProvider?
  oauthId                                     String?
  createdAt                                   DateTime       @default(now())
  updatedAt                                   DateTime
  lastLogin                                   DateTime?
  assignedTasks                               String[]
  audit_logs                                  audit_logs[]
  team_members_team_members_assignedByTousers team_members[] @relation("team_members_assignedByTousers")
  team_members_team_members_userIdTousers     team_members[] @relation("team_members_userIdTousers")
  teams                                       teams[]
}

enum AuditAction {
  SIGNUP
  LOGIN
  LOGOUT
  INVITE
  JOIN_TEAM
  LEAVE_TEAM
  UPDATE_PROFILE
  ROLE_CHANGED
  PERMISSION_GRANTED
  PERMISSION_REVOKED
  PROJECT_CREATED
  PROJECT_DELETED
  TASK_ASSIGNED
  TASK_COMPLETED
}

enum Gender {
  MALE
  FEMALE
  OTHER
  PREFER_NOT_TO_SAY
}

enum OAuthProvider {
  GOOGLE
  GITHUB
  MICROSOFT
}

enum Plan {
  FREE
  PRO
  ENTERPRISE
}

enum Role {
  OWNER
  ADMIN
  TEAM_LEAD
  DEVELOPER
  TESTER
  MEMBER
}

enum TeamRole {
  OWNER
  ADMIN
  TEAM_LEAD
  DEVELOPER
  TESTER
  MEMBER
}
